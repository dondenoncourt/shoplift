<% provide(:title, 'Profile Edit') %>
<div class="leftCol profile">
    <div class="person">
      <img src="img/user-large-john.jpg" width="200" height="200" alt="profile-large"/>
      <h2>John Harrington<br/><span class="location">New York, NY</span></h2>
      <a class="button buttonOn" href="#">Edit Profile</a>
    </div>
    <ul class="personStats">
      <li class="current"><a href="#">200 Items Shoplifted</a></li>
      <li><a href="#">200 Followers</a></li>
      <li><a href="#">200 Followees</a></li>
    </ul>
    <div class="profileText">Profile quis hendrerit et tation, facilisi vel duis commodo vulputate. Profile quis hendrerit et tation, facilisi vel duis commodo vulputate.</div>
    <div class="profileUrl">
      <a href="#">individualurl.com</a>
    </div>
    <h3>Top Tags</h3>
    <ul class="topTags">
      <li><a href="#">Lorem Ipsum Tag</a></li>
      <li><a href="#">Lorem Ipsum Tag</a></li>
      <li><a href="#">Lorem Ipsum Tag</a></li>
      <li><a href="#">Lorem Ipsum Tag</a></li>
      <li><a href="#">Lorem Ipsum Tag</a></li>
    </ul>
    <a href="#">Show More</a>
  </div>

  <div class="rightCol">
    <div class="entry settings">
      <h2>Edit Your Profile Settings</h2>
      <form action="/users/<%= current_user.id %>/edit" id="user_form" method="post" >
        <h3>Personal Settings</h3>
        <ul class="formList">
          <li>
            <label for="fullName">Name</label>
            <input type="text" class="text" name="user[full_name]" id="fullName" />
          </li>
          <li>
            <label for="email">Email</label>
            <input type="text" class="text" name="user[email]" id="email" />
          </li>
          <li>
            <label for="password">Password</label>
            <input type="password" class="text" name="fake-dummy" value="xxxxxxxxx />
              <a href="#">Change Password</a>
          </li>
          <li>
            <label for="country">Country</label>
            <select name="country" id="country">
              <option>United States</option>
              <option>Canada</option>
            </select>
          </li>
          <li>
            <label for="zipcode">Zip Code</label>
            <input type="text" class="text" name="user[zipcode]" id="zipcode" />
          </li>
          <li>
            <label for="bio">Bio</label>
            <textarea name="user[biography]" id="bio"></textarea>
            <span class="characterCount">XXX Characters Left</span>
          </li>
          <li>
            <label for="website">Website</label>
            <input type="text" class="text" name="user[website]" id="website" value="individualurl.com"/>
          </li>
          <li>
            <label for="photo">Photo or Logo</label>
            <img src="img/user-large-john.jpg" id="formImage" alt="profile-large"/>
            <p>
              <a href="#" class="modal" data-modalType="upload_avatar">Upload a New Photo</a><br/>
              <a href="#">Refresh from Facebook</a><br/>
              <a href="#">Refresh from Twitter</a>
            </p>
          </li>
        </ul>
        <h3>Notification Settings</h3>
        <ul class="formList radioList">
          <li>
            <div class="radioDesc">Tell me when someone new starts following me:</div>
            <input type="radio" class="radio" name="user[notify_new_follower]" value="true" id="newFollow-yes" /><label for="newFollow-yes">Yes</label>
            <input type="radio" class="radio" name="user[notify_new_follower]" value="false" id="newFollow-no" /><label for="newFollow-no">No</label>
          </li>
          <li>
            <div class="radioDesc">Tell me when someone relifts an item of mine:</div>
            <input type="radio" class="radio" name="user[notify_relift]" value="true" id="relift-yes" /><label for="relift-yes">Yes</label>
            <input type="radio" class="radio" name="user[notify_relift]" value="false" id="relift-no" /><label for="relift-no">No</label>
          </li>
          <li>
            <div class="radioDesc">Update me on what I've been missing:</div>
            <input type="radio" class="radio" name="user[notify_missing]" value="daily" id="missing-daily" /><label for="missing-daily">Daily</label>
            <input type="radio" class="radio" name="user[notify_missing]" value="weekly" id="missing-weekly" /><label for="missing-weekly">Weekly</label>
            <input type="radio" class="radio" name="user[notify_missing]" value="monthly" id="missing-monthly" /><label for="missing-monthly">Monthly</label>
            <input type="radio" class="radio" name="user[notify_missing]" value="never" id="missing-never" /><label for="missing-never">Never</label>
          </li>
        </ul>
        <h3>Linked Accounts</h3>
        <ul class="formList">
          <li>
            <label>Facebook</label>
            <div class="pillbox"><a href="#" class="current onLink">On</a><a href="#" class="offLink">Off</a></div>
          </li>
          <li>
            <label>Twitter</label>
            <div class="pillbox"><a href="#" class="onLink">On</a><a href="#" class="current offLink">Off</a></div>
          </li>
          <li>
            <label>Pinterest</label>
            <div class="pillbox"><a href="#" class="current onLink">On</a><a href="#" class="offLink">Off</a></div>
          </li>
        </ul>
        <h3>Follow Me</h3>
        <p>Embed this button on your blog or website! Just copy the code below and paste it into your site where you'd like it to appear.</p>
        <div class="code">&lt;a href="#"&gt;Lorem Ipsum Code Lorem Ipsum Code Lorem Ipsum Code Lorem Ipsum Code&lt;/a&gt;</div>
        <div class="divider"></div>
        <input type="submit" name="submit" value="Save Settings" class="submit" />
      </form>
    </div>
  </div>

  <div class="clear"></div>
  <div id="basic-modal-content"></div>
  <script>
    $('#user_form').submit(function () {
      $.ajax({
        url:'/users/<%= current_user.id %>/edit',
        type:'POST',
        data: $('#user_form').serialize(),
        dataType:'json',
        success:function(data) {
          alert('Updated but we need to decide what page to show next');
        },
        error:function(XMLHttpRequest,textStatus,errorThrown){
            alert(XMLHttpRequest.responseText);
        }
      });
      return false;
    });
    var user;
    var avatar_url_thumb;
    var avatar_url_small;
    var first_time = true;
    function getUserInfo() {
      $.ajax({
        url:'/users/username/<%= current_user.username%>',
        type:'GET',
        dataType:'json',
        success:function(data) {
            user = data.extract;
            avatar_url_thumb = data.avatar_url_thumb;
            avatar_url_small = data.avatar_url_small;
            if (first_time) {
              initPage();
            }
            setAvatars();
            first_time = false;
        },
        error:function(XMLHttpRequest,textStatus,errorThrown){}
      });
    }

    getUserInfo();

    function initPage() {
      if (window.console) console.log(user.last_name);
      $('#fullName').val(user.full_name);
      $('#email').val(user.email);
      $('#vanity_url').val(user.vanity_url);
      $('#website').val(user.url);
      $('#country').val(user.country);
      $('#zipcode').val(user.zipcode);
      $('#bio').val(user.biography);
      <%#$('.characterCount').html(110-user.biography.length+' Characters Left');%>
      if (user.notify_new_follower == true) {
        $('#newFollow-yes').attr('checked', true);
      } else {
        $('#newFollow-no').attr('checked', true);
      }
      if (user.notify_relift == true) {
        $('#relift-yes').attr('checked', true);
      } else {
        $('#relift-no').attr('checked', true);
      }
      if (user.notify_missing == 'daily') {
        $('#missing-daily').attr('checked', true);
      } else if (user.notify_missing == 'weekly') {
        $('#missing-weekly').attr('checked', true);
      } else if (user.notify_missing == 'monthly') {
        $('#missing-monthly').attr('checked', true);
      } else if (user.notify_missing == 'never') {
        $('#missing-never').attr('checked', true);
      }
    }
    function setAvatars() {
      $('div.person img').last().attr('src', avatar_url_small);
      $('#formImage').attr('src', avatar_url_thumb);
    }
    function reloadAvatars() {
      getUserInfo();
    }

    $('.onLink').click(function () {
      alert('To Be Implemenented');
      return false;
    });
    $('.offLink').click(function () {
      alert('To Be Implemenented');
      return false;
    });
    $(document).ready(function () {
      console.log($('#bio').html());
      $('.characterCount').html(110-($('#bio').html().length)+' Characters Left');
    });
    $('#bio').keyup(function () {
      console.log($('#bio').val().length);
      $('.characterCount').html(110-($('#bio').val().length)+' Characters Left');
    });
</script>
