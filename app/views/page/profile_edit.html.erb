<% provide(:title, 'Profile Edit') %>
<div class="leftCol profile">
    <div class="person">
      <img src="img/user-large-john.jpg" width="200" height="200" alt="profile-large"/>
      <h2>John Harrington<br/><span class="location">New York, NY</span></h2>
      <a class="button buttonOn" href="#">Edit Profile</a>
    </div>
    <ul class="personStats">
      <li class="current"><a href="#">200 Items Shoplifted</a></li>
      <li><a href="#">200 Followers</a></li>
      <li><a href="#">200 Followees</a></li>
    </ul>
    <div class="profileText">Profile quis hendrerit et tation, facilisi vel duis commodo vulputate. Profile quis hendrerit et tation, facilisi vel duis commodo vulputate.</div>
    <div class="profileUrl">
      <a href="#">individualurl.com</a>
    </div>
    <h3>Top Tags</h3>
    <ul class="topTags">
      <li><a href="#">Lorem Ipsum Tag</a></li>
      <li><a href="#">Lorem Ipsum Tag</a></li>
      <li><a href="#">Lorem Ipsum Tag</a></li>
      <li><a href="#">Lorem Ipsum Tag</a></li>
      <li><a href="#">Lorem Ipsum Tag</a></li>
    </ul>
    <a href="#">Show More</a>
  </div>

  <div class="rightCol">
    <div class="entry settings">
      <h2>Edit Your Profile Settings</h2>
      <form action="/users/<%= current_user.id %>/edit" id="user_form" method="post" >
        <%= render "profile_fields" %>
        <h3>Follow Me</h3>
        <p>Embed this button on your blog or website! Just copy the code below and paste it into your site where you'd like it to appear.</p>
        <div class="code">&lt;a href="#"&gt;Lorem Ipsum Code Lorem Ipsum Code Lorem Ipsum Code Lorem Ipsum Code&lt;/a&gt;</div>
        <div class="divider"></div>
        <input type="submit" name="submit" value="Save Settings" class="submit" />
      </form>
    </div>
  </div>

  <div class="clear"></div>
  <div id="basic-modal-content"></div>
  <script>
    $('#user_form').submit(function () {
      $.ajax({
        url:'/users/<%= current_user.id %>/edit',
        type:'POST',
        data: $('#user_form').serialize(),
        dataType:'json',
        success:function(data) {
          alert('Updated but we need to decide what page to show next');
        },
        error:function(XMLHttpRequest,textStatus,errorThrown){
            alert(XMLHttpRequest.responseText);
        }
      });
      return false;
    });
    var user;
    var avatar_url_thumb;
    var avatar_url_small;
    var first_time = true;
    function getUserInfo() {
      $.ajax({
        url:'/users/username/<%= current_user.username%>',
        type:'GET',
        dataType:'json',
        success:function(data) {
            user = data.extract;
            avatar_url_thumb = data.avatar_url_thumb;
            avatar_url_small = data.avatar_url_small;
            if (first_time) {
              initPage();
            }
            setAvatars();
            first_time = false;
        },
        error:function(XMLHttpRequest,textStatus,errorThrown){}
      });
    }
    getUserInfo();
    function initPage() {
      if (window.console) console.log(user.last_name);
      $('#firstName').val(user.first_name);
      $('#lastName').val(user.last_name);
      $('#email').val(user.email);
      $('#vanity_url').val(user.vanity_url);
      $('#website').val(user.url);
      $('#country').val(user.country);
      $('#zipcode').val(user.zipcode);
      $('#bio').val(user.biography);
      <%#$('.characterCount').html(110-user.biography.length+' Characters Left');%>
      if (user.notify_new_follower == true) {
        $('#newFollow-yes').attr('checked', true);
      } else {
        $('#newFollow-no').attr('checked', true);
      }
      if (user.notify_relift == true) {
        $('#relift-yes').attr('checked', true);
      } else {
        $('#relift-no').attr('checked', true);
      }
      if (user.notify_missing == 'daily') {
        $('#missing-daily').attr('checked', true);
      } else if (user.notify_missing == 'weekly') {
        $('#missing-weekly').attr('checked', true);
      } else if (user.notify_missing == 'monthly') {
        $('#missing-monthly').attr('checked', true);
      } else if (user.notify_missing == 'never') {
        $('#missing-never').attr('checked', true);
      }
    }
    function setAvatars() {
      $('div.person img').last().attr('src', avatar_url_small);
      $('#formImage').attr('src', avatar_url_thumb);
    }
    function reloadAvatars() {
      getUserInfo();
    }
  </script>
